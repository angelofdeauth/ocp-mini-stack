# Host Setup
sudo dnf copr enable jdoss/wireguard -y && sudo dnf update -y
sudo dnf install -y wireguard-dkms wireguard-tools


lxc profile copy original openwrt
lxc profile set openwrt security.privileged true
lxc profile set openwrt linux.kernel_modules wireguard,ip6_udp_tunnel,udp_tunnel
lxc profile device set openwrt eth0 nictype bridged
lxc profile device set openwrt eth0 parent external
lxc profile device add openwrt eth1 nic nictype=bridged parent=internal name=eth1
lxc profile device add openwrt eth2 nic nictype=bridged parent=internal name=eth2
lxc init bcio:openwrt gateway -p openwrt
lxc exec gateway -- /bin/bash -c "sed -i 's/192.168.1/${ocp_ministack_SUBNET}/g' /etc/config/network"

opkg install luci-proto-wireguard luci-app-wireguard wireguard kmod-wireguard wireguard-tools
