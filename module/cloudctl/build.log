dnf update
sudo dnf distrosync

dnf install -y openssh-server sudo libvirt-client squashfuse snapd git jq

dnf remove fedora-release-container-30-6
dnf group install 'Fedora Workstation' --excludepkg xorg-x11-drv-omap --excludepkg totem-nautilus --excludepkg xorg-x11-drv-armsoc --excludepkg powerpc-utils --excludepkg lsvpd --excludepkg fedora-release-container-30-6 
dnf group install 'Fedora Workstation'

git config --global user.name usrbinkat
git config --global user.email usrbinkat@ministack.dev

ssh-keygen -b 4086 -t rsa -f ~/.ssh/id_rsa -q -P '' 
curl -L https://github.com/usrbinkat.keys | tee -a .ssh/authorized_keys 
chmod 600 .ssh/config 
sudo chown kmorgan:kmorgan ~ -R

systemctl status systemd-networkd
systemctl restart systemd-networkd
systemctl disable tpm2-abrmd
systemctl stop tpm2-abrmd

systemctl start graphical.target
systemctl status xrdp

netstat -nl --interfaces=eth0
systemctl list-unit-files --state=masked
systemctl unmask systemd-logind

usermod -a -G wheel kmorgan
usermod -a -G admins kmorgan

dnf install gnome-tweaks

nmcli con show
nmcli con del b8dc9c21-f5dc-4c79-97e9-adef3084b926
nmcli con del eth0

systemctl status systemd-networkd
systemctl status NetworkManager

cd /etc/NetworkManager/system-connections/

nmcli g
nmcli d
nmcli edit eth0
nmcli device set eth0 managed yes

systemctl enable --now httpd
systemctl status httpd
firewall-cmd --add-service=http
firewall-cmd --add-service=https

lxc remote add hrev01 10.10.20.2
lxc remote set-default hrev01
lxc list

usermod -aG lxd kmorgan
usermod -aG admins kmorgan

firewall-cmd --state
firewall-cmd --list-ports
firewall-cmd --service=http/tcp --service=https/tcp --permanent
firewall-cmd --add-service=http/tcp --add-service=https/tcp --permanent
firewall-cmd --add-service=http --add-service=https --permanent
firewall-cmd --reload

dd if=/dev/zero of=11GB.dd bs=1024 count=1024000

wget https://mirror.openshift.com/pub/openshift-v4/clients/ocp/latest/openshift-install-linux-4.2.0.tar.gz
tar xvf openshift-install-linux-4.2.0.tar.gz 
cp openshift-install /usr/bin/openshift-install

source secrets/pull-secret && echo $PullSecret 

openshift-install create manifests --dir $(pwd) 

sudo timedatectl set-timezone America/Denver

dnf install libvirt-client
sudo dnf install snapd
sudo dnf install squashfuse
sudo ln -s /var/lib/snapd/snap /snap
sudo snap install lxd
sudo usermod -aG lxd kmorgan
lxc remote add rhev01 10.10.20.2
lxc remote set-default rhev01
rm Videos/ Templates/ Public/ Pictures/ Music/ Desktop/ -rf

openshift-install create ignition-configs --dir=$(pwd) --log-level debug

wget https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/4.2/latest/rhcos-4.2.0-x86_64-metal-bios.raw.gz
wget https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/4.2/4.2.0/rhcos-4.2.0-x86_64-installer-initramfs.img
wget https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/4.2/4.2.0/rhcos-4.2.0-x86_64-installer-kernel

virsh connect qemu+ssh://root@10.10.20.2/system
virsh connect qemu+ssh://root@10.10.20.2/system list

virsh -c qemu+ssh://root@10.10.20.2/system list
echo 'alias virsh="virsh -c qemu+ssh://root@10.10.20.2/system"' >>.bashrc 
wget https://mirror.openshift.com/pub/openshift-v4/clients/ocp/4.1.6/openshift-install-linux-4.1.6.tar.gz
lxc remote add carrier carrier.ministack.dev
lxc remote set-default carrier

virsh -c qemu+ssh://root@10.10.20.2/system list --all
watch -c virsh list --all

systemctl enable --now sshd
useradd --defaults --create-home --groups=wheel kmorgan
useradd --groups wheel --defaults --create-home kmorgan
passwd kmorgan

curl --insecure https://api.ocp4.ministack.dev:6443/healthz
curl --insecure https://api.ocp4.ministack.dev:6443/version
curl --insecure https://api.ocp4.ministack.dev:6443/api/v1/namespaces
curl --insecure https://api.ocp4.ministack.dev:22623/config/master -Ik  
curl --insecure https://api-int.ocp4.ministack.dev:22623/config/master
curl --insecure https://bootstrap.ocp4.ministack.dev:6443/oapi/
curl --insecure https://bootstrap.ocp4.ministack.dev:6443/healthz
curl --insecure https://bootstrap.ocp4.ministack.dev:6443/version
curl --insecure https://master1.ocp4.ministack.dev:6443/healthz
curl --insecure https://master1.ocp4.ministack.dev:6443/version

export KUBECONFIG=$(pwd)/auth/kubeconfig
openshift-install wait-for bootstrap-complete --log-level debug

oc login -u kubeadmin
oc whoami --show-token
oc whoami --show-console 
oc status --suggest

dig bootstrap
dig bootstrap.ocp4.ministack.dev
dig bootstrap
dig bootstrap.ocp4.ministack.dev
dig bootstrap
dig bootstrap.ocp4.ministack.dev
dig bootstrap
dig bootstrap.ocp4.ministack.dev
dig bootstrap
nslookup carrier
dig carrier

scp -rp carrier.ministack.dev:/root/inventory/pxelinux.0 tftp:/tftpboot/
scp -rp carrier.ministack.dev:/root/inventory/pxelinux.0 tftp:/tftpboot
scp -rp carrier.ministack.dev:/root/inventory/pxelinux.0/ tftp:/tftpboot/pxelinux.0
scp -rp carrier.ministack.dev:/root/inventory/pxelinux.0/* tftp:/tftpboot/pxelinux.0/
scp -rp carrier.ministack.dev:/root/inventory/pxelinux.0/ tftp:/tftpboot/pxelinux.cfg
scp -rp carrier.ministack.dev:/root/inventory/pxelinux.cfg tftp:/tftpboot/
scp -rp carrier.ministack.dev:/root/inventory/ethers dnsmasq:/etc/

htpasswd -c -B -b </path/to/users.htpasswd> <user_name> <password>
htpasswd -c -B -b users.htpasswd kmorgan PASSWD
